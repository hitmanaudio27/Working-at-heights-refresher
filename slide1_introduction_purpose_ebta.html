<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EBTA Working at Heights - Introduction & Purpose | NEL-STH-NSA-5900-OHS-PRC-0008</title>
    
    <!-- Three.js and dependencies -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tween.js/18.6.4/tween.umd.js"></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #0f1419 0%, #1a2332 50%, #2d3748 100%);
            overflow: hidden;
            height: 100vh;
            color: white;
        }
        
        /* Eastern BTA 3-wall projection optimisation (9m x 2m walls) */
        .container {
            width: 100vw;
            height: 100vh;
            position: relative;
            display: flex;
        }
        
        /* Main 3D canvas area */
        #canvas-container {
            flex: 2;
            position: relative;
            background: rgba(15, 20, 25, 0.1);
        }
        
        /* Side information panel */
        .info-panel {
            flex: 1;
            padding: 30px;
            background: rgba(0, 0, 0, 0.85);
            backdrop-filter: blur(15px);
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            border-left: 4px solid #e53e3e;
            overflow-y: auto;
        }
        
        .header {
            text-align: center;
            margin-bottom: 25px;
        }
        
        .header h1 {
            font-size: 2.8em;
            color: #e53e3e;
            margin-bottom: 8px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.7);
            font-weight: 700;
        }
        
        .header h2 {
            font-size: 1.4em;
            color: #ffffff;
            font-weight: 300;
            margin-bottom: 5px;
        }
        
        .header .doc-ref {
            font-size: 0.9em;
            color: #a0aec0;
            font-family: 'Courier New', monospace;
        }
        
        .purpose-section {
            margin: 25px 0;
        }
        
        .purpose-section h3 {
            font-size: 1.4em;
            color: #ffd700;
            margin-bottom: 15px;
            border-bottom: 2px solid #ffd700;
            padding-bottom: 8px;
        }
        
        .mandatory-requirements {
            background: rgba(229, 62, 62, 0.1);
            padding: 20px;
            border-radius: 8px;
            border-left: 4px solid #e53e3e;
            margin: 15px 0;
        }
        
        .requirement-item {
            margin: 12px 0;
            padding-left: 15px;
            position: relative;
        }
        
        .requirement-item:before {
            content: "â€¢";
            color: #e53e3e;
            font-weight: bold;
            position: absolute;
            left: 0;
        }
        
        .hierarchy-emphasis {
            background: rgba(255, 215, 0, 0.1);
            padding: 18px;
            border-radius: 8px;
            border-left: 4px solid #ffd700;
            margin: 20px 0;
        }
        
        .hierarchy-emphasis h4 {
            color: #ffd700;
            margin-bottom: 10px;
            font-size: 1.2em;
        }
        
        .hierarchy-levels {
            display: grid;
            grid-template-columns: auto 1fr;
            gap: 8px;
            margin: 15px 0;
        }
        
        .hierarchy-number {
            background: linear-gradient(135deg, #e53e3e, #c53030);
            color: white;
            width: 25px;
            height: 25px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 0.9em;
        }
        
        .hierarchy-text {
            font-size: 0.95em;
            padding: 2px 0;
            align-self: center;
        }
        
        .statistics-legend {
            margin: 20px 0;
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            margin: 10px 0;
            font-size: 1.1em;
        }
        
        .legend-colour {
            width: 18px;
            height: 18px;
            margin-right: 12px;
            border-radius: 3px;
            border: 1px solid rgba(255,255,255,0.3);
        }
        
        .compliance-footer {
            margin-top: auto;
            padding-top: 20px;
            border-top: 1px solid rgba(255, 255, 255, 0.2);
            font-size: 0.85em;
            color: #cbd5e0;
            line-height: 1.5;
        }
        
        .alarp-note {
            background: rgba(255, 215, 0, 0.15);
            padding: 12px;
            border-radius: 6px;
            margin: 10px 0;
            font-style: italic;
            border-left: 3px solid #ffd700;
            font-size: 0.9em;
        }
        
        /* Touch interaction feedback */
        .touch-hint {
            position: absolute;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(229, 62, 62, 0.9);
            padding: 12px 25px;
            border-radius: 25px;
            font-size: 1.0em;
            animation: pulse 2s infinite;
            z-index: 1000;
            box-shadow: 0 4px 15px rgba(229, 62, 62, 0.4);
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 0.8; transform: translateX(-50%) scale(1); }
            50% { opacity: 1; transform: translateX(-50%) scale(1.05); }
        }
        
        /* Popup modal for statistics */
        .stat-popup {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0, 0, 0, 0.95);
            border: 2px solid #e53e3e;
            border-radius: 12px;
            padding: 25px;
            min-width: 400px;
            max-width: 500px;
            z-index: 2000;
            display: none;
            box-shadow: 0 10px 30px rgba(0,0,0,0.7);
        }
        
        .stat-popup h3 {
            color: #e53e3e;
            margin-bottom: 15px;
            font-size: 1.6em;
        }
        
        .stat-popup .close-btn {
            position: absolute;
            top: 10px;
            right: 15px;
            background: none;
            border: none;
            color: #e53e3e;
            font-size: 1.8em;
            cursor: pointer;
            padding: 5px;
        }
        
        .stat-popup .close-btn:hover {
            color: #ffffff;
        }
        
        /* Responsive design for Eastern BTA system */
        @media (min-width: 2560px) {
            .header h1 { font-size: 4em; }
            .header h2 { font-size: 2em; }
            .info-panel { padding: 50px; }
            .hierarchy-text { font-size: 1.2em; }
        }
        
        /* Large touch zones for immersive interaction */
        .touch-zone {
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .touch-zone:hover {
            filter: brightness(1.3);
        }
        
        .ebta-branding {
            background: linear-gradient(45deg, #e53e3e, #c53030);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            font-weight: 800;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- 3D Canvas Container -->
        <div id="canvas-container">
            <div class="touch-hint">Touch any bar to view fall prevention controls</div>
            
            <!-- Statistics Popup Modal -->
            <div id="stat-popup" class="stat-popup">
                <button class="close-btn" onclick="closeStatPopup()">&times;</button>
                <h3 id="popup-title"></h3>
                <div id="popup-content"></div>
            </div>
        </div>
        
        <!-- Information Panel -->
        <div class="info-panel">
            <div class="header">
                <h1 class="ebta-branding">EBTA Working at Heights</h1>
                <h2>Prevention-First Safety Training</h2>
                <div class="doc-ref">NEL-STH-NSA-5900-OHS-PRC-0008 Rev 04</div>
            </div>
            
            <div class="purpose-section">
                <h3>Mandatory Requirements & Obligations</h3>
                <div class="mandatory-requirements">
                    <div class="requirement-item">
                        Works where risk of person falling from one level to another could result in serious injury
                    </div>
                    <div class="requirement-item">
                        Works where risk of items being dropped from height could result in serious injury or damage
                    </div>
                    <div class="requirement-item">
                        Safe and appropriate use of plant or equipment for works conducted at height
                    </div>
                </div>
                
                <div class="hierarchy-emphasis">
                    <h4>EBTA Prevention-First Approach</h4>
                    <p style="margin-bottom: 15px; font-size: 0.95em;">Eastern BTA emphasises implementation of controls that intend to prevent exposure to risk by eliminating that risk.</p>
                    
                    <div class="hierarchy-levels">
                        <div class="hierarchy-number">1</div>
                        <div class="hierarchy-text">Elimination - Remove the hazard entirely</div>
                        
                        <div class="hierarchy-number">2</div>
                        <div class="hierarchy-text">Substitution - Replace with safer alternatives</div>
                        
                        <div class="hierarchy-number">3</div>
                        <div class="hierarchy-text">Isolation - Install physical safeguards</div>
                        
                        <div class="hierarchy-number">4</div>
                        <div class="hierarchy-text">Engineering - MEWP, scaffold systems</div>
                        
                        <div class="hierarchy-number">5</div>
                        <div class="hierarchy-text">Administrative - Permits, procedures</div>
                        
                        <div class="hierarchy-number">6</div>
                        <div class="hierarchy-text">PPE - Personal protective equipment</div>
                    </div>
                    
                    <div class="alarp-note">
                        <strong>ALARP Principle:</strong> Where elimination is not possible, all effort shall be made to mitigate risks to levels as low as reasonably practicable.
                    </div>
                </div>
            </div>
            
            <div class="statistics-legend">
                <h3 style="color: #ffd700; margin-bottom: 15px;">Risk Control Categories</h3>
                <div class="legend-item">
                    <div class="legend-colour" style="background-color: #dc143c;"></div>
                    <span>High Risk - Fall from height >4m</span>
                </div>
                <div class="legend-item">
                    <div class="legend-colour" style="background-color: #ff8c00;"></div>
                    <span>Medium Risk - Fall 2-4m height</span>
                </div>
                <div class="legend-item">
                    <div class="legend-colour" style="background-color: #ffd700;"></div>
                    <span>Low Risk - Fall <2m height</span>
                </div>
                <div class="legend-item">
                    <div class="legend-colour" style="background-color: #32cd32;"></div>
                    <span>Eliminated - Work at ground level</span>
                </div>
            </div>
            
            <div class="compliance-footer">
                <p><strong>Compliance Framework:</strong> This procedure aligns with LORA HSEMS Primary Standards, WorkSafe Victoria Compliance Code: Prevention of Falls in General Construction, AS 1891 series, AS 1576 series, and AQF Level 2 training outcomes.</p>
                <br>
                <p><strong>Documentation Requirements:</strong> All working at height activities must form part of Package Risk Assessments (PRA) and Work Pack Risk Assessments (WPRA), accompanied by Safe Work Method Statements (SWMS).</p>
            </div>
        </div>
    </div>

    <script>
        // Global variables
        let scene, camera, renderer, bars = [], raycaster, mouse, animationId;
        
        // EBTA risk categorisation data based on actual procedure
        const riskCategoriesData = [
            {
                category: 'Eliminated',
                description: 'Work at Ground Level',
                count: 45,
                color: 0x32cd32,
                details: {
                    examples: ['Prefabricated roofs at ground level', 'Prefabricated wall frames horizontally', 'Permanent guardrails in design'],
                    controls: 'Design work to eliminate requirement for works at height',
                    effectiveness: 'Highest level of protection',
                    requirements: 'Consider risks early in design stage via SiD workshops'
                }
            },
            {
                category: 'Low Risk',
                description: 'Fall <2m Height',
                count: 32,
                color: 0xffd700,
                details: {
                    examples: ['Modular scaffolding <4m', 'Platform ladders with back bars', 'Temporary work platforms'],
                    controls: 'Fall prevention devices, temporary work platforms',
                    effectiveness: 'High level of protection',
                    requirements: 'Equipment inspections, competent persons'
                }
            },
            {
                category: 'Medium Risk',
                description: 'Fall 2-4m Height',
                count: 28,
                color: 0xff8c00,
                details: {
                    examples: ['Scaffolding >4m height', 'Edge protection systems', 'Birdcage scaffolds', 'Loading platforms'],
                    controls: 'Work positioning systems, travel restraint systems',
                    effectiveness: 'Moderate level of protection',
                    requirements: 'TWC involvement, scaffold plans, handover certificates'
                }
            },
            {
                category: 'High Risk',
                description: 'Fall >4m Height',
                count: 18,
                color: 0xdc143c,
                details: {
                    examples: ['Cantilevered scaffolds', 'Hung scaffolds', 'Suspended scaffolds', 'Crane-liftable scaffolds'],
                    controls: 'Fall injury minimisation systems, individual fall arrest',
                    effectiveness: 'Lower level of protection',
                    requirements: 'Advanced HRWL, TWD approval, permit to load, emergency response plans'
                }
            }
        ];
        
        function init() {
            // Scene setup
            scene = new THREE.Scene();
            scene.background = new THREE.Color(0x0f1419);
            
            // Camera setup optimised for Eastern BTA projection
            camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
            camera.position.set(0, 6, 12);
            camera.lookAt(0, 3, 0);
            
            // Renderer setup
            renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
            renderer.setSize(window.innerWidth * 0.67, window.innerHeight);
            renderer.setClearColor(0x000000, 0);
            renderer.shadowMap.enabled = true;
            renderer.shadowMap.type = THREE.PCFSoftShadowMap;
            
            const canvasContainer = document.getElementById('canvas-container');
            canvasContainer.appendChild(renderer.domElement);
            
            // Lighting setup
            const ambientLight = new THREE.AmbientLight(0x404040, 0.5);
            scene.add(ambientLight);
            
            const directionalLight = new THREE.DirectionalLight(0xffffff, 0.8);
            directionalLight.position.set(8, 10, 5);
            directionalLight.castShadow = true;
            directionalLight.shadow.mapSize.width = 2048;
            directionalLight.shadow.mapSize.height = 2048;
            scene.add(directionalLight);
            
            // Add key light for dramatic effect
            const keyLight = new THREE.SpotLight(0xe53e3e, 0.6);
            keyLight.position.set(-8, 8, 8);
            keyLight.target.position.set(0, 0, 0);
            scene.add(keyLight);
            scene.add(keyLight.target);
            
            // Create EBTA risk categorisation chart
            createRiskChart();
            
            // Setup interaction
            setupInteraction();
            
            // Start animation loop
            animate();
        }
        
        function createRiskChart() {
            const barWidth = 1.8;
            const barSpacing = 3.5;
            const startX = -6;
            
            riskCategoriesData.forEach((data, index) => {
                const x = startX + (index * barSpacing);
                const height = (data.count / 10) + 1; // Scale for visibility
                
                // Create risk category bar
                const bar = createRiskBar(height, data.color, x, data.category, index);
                bars.push(bar);
                
                // Add category labels
                const labelGeometry = new THREE.PlaneGeometry(2.5, 0.6);
                const labelTexture = createTextTexture(data.category, '#ffffff', '20px Arial');
                const labelMaterial = new THREE.MeshBasicMaterial({ map: labelTexture, transparent: true });
                const categoryLabel = new THREE.Mesh(labelGeometry, labelMaterial);
                categoryLabel.position.set(x, -1.2, 0);
                categoryLabel.lookAt(camera.position);
                scene.add(categoryLabel);
                
                // Add count labels on bars
                const countGeometry = new THREE.PlaneGeometry(1.5, 0.4);
                const countTexture = createTextTexture(data.count.toString(), '#ffffff', 'bold 24px Arial');
                const countMaterial = new THREE.MeshBasicMaterial({ map: countTexture, transparent: true });
                const countLabel = new THREE.Mesh(countGeometry, countMaterial);
                countLabel.position.set(x, height + 0.5, 0);
                countLabel.lookAt(camera.position);
                scene.add(countLabel);
            });
            
            // Add chart title
            const titleGeometry = new THREE.PlaneGeometry(14, 1.2);
            const titleTexture = createTextTexture('EBTA Working at Heights Risk Categories', '#e53e3e', 'bold 32px Arial');
            const titleMaterial = new THREE.MeshBasicMaterial({ map: titleTexture, transparent: true });
            const title = new THREE.Mesh(titleGeometry, titleMaterial);
            title.position.set(0, 8, 0);
            title.lookAt(camera.position);
            scene.add(title);
            
            // Add subtitle
            const subtitleGeometry = new THREE.PlaneGeometry(12, 0.8);
            const subtitleTexture = createTextTexture('Prevention-First Approach & Hierarchy of Controls', '#ffd700', '24px Arial');
            const subtitleMaterial = new THREE.MeshBasicMaterial({ map: subtitleTexture, transparent: true });
            const subtitle = new THREE.Mesh(subtitleGeometry, subtitleMaterial);
            subtitle.position.set(0, 7, 0);
            subtitle.lookAt(camera.position);
            scene.add(subtitle);
            
            // Add base platform
            const baseGeometry = new THREE.BoxGeometry(16, 0.2, 4);
            const baseMaterial = new THREE.MeshLambertMaterial({ 
                color: 0x2d3748,
                transparent: true,
                opacity: 0.8 
            });
            const basePlatform = new THREE.Mesh(baseGeometry, baseMaterial);
            basePlatform.position.set(0, -2, 0);
            basePlatform.receiveShadow = true;
            scene.add(basePlatform);
        }
        
        function createRiskBar(height, color, x, category, index) {
            const geometry = new THREE.BoxGeometry(1.5, height, 1.5);
            const material = new THREE.MeshLambertMaterial({ 
                color: color,
                transparent: true,
                opacity: 0.9 
            });
            
            const bar = new THREE.Mesh(geometry, material);
            bar.position.set(x, height / 2 - 1, 0);
            bar.castShadow = true;
            bar.receiveShadow = true;
            
            // Add interaction data
            bar.userData = {
                category: category,
                index: index,
                originalColor: color,
                originalHeight: height
            };
            
            scene.add(bar);
            
            // Animate bar growth with EBTA-themed timing
            bar.scale.y = 0;
            const targetScale = { y: 1 };
            const startScale = { y: 0 };
            
            new TWEEN.Tween(startScale)
                .to(targetScale, 1200 + (index * 300))
                .easing(TWEEN.Easing.Cubic.Out)
                .onUpdate(() => {
                    bar.scale.y = startScale.y;
                })
                .delay(index * 400)
                .start();
            
            return bar;
        }
        
        function createTextTexture(text, color, font) {
            const canvas = document.createElement('canvas');
            const context = canvas.getContext('2d');
            canvas.width = 512;
            canvas.height = 128;
            
            context.fillStyle = 'rgba(0, 0, 0, 0)';
            context.fillRect(0, 0, canvas.width, canvas.height);
            
            context.fillStyle = color;
            context.font = font;
            context.textAlign = 'center';
            context.textBaseline = 'middle';
            context.fillText(text, canvas.width / 2, canvas.height / 2);
            
            const texture = new THREE.CanvasTexture(canvas);
            texture.needsUpdate = true;
            return texture;
        }
        
        function setupInteraction() {
            raycaster = new THREE.Raycaster();
            mouse = new THREE.Vector2();
            
            const canvas = renderer.domElement;
            
            // Touch and mouse event listeners
            canvas.addEventListener('touchstart', onTouch, false);
            canvas.addEventListener('click', onTouch, false);
            canvas.addEventListener('mousemove', onMouseMove, false);
        }
        
        function onTouch(event) {
            event.preventDefault();
            
            const rect = renderer.domElement.getBoundingClientRect();
            let clientX, clientY;
            
            if (event.touches && event.touches.length > 0) {
                clientX = event.touches[0].clientX;
                clientY = event.touches[0].clientY;
            } else {
                clientX = event.clientX;
                clientY = event.clientY;
            }
            
            mouse.x = ((clientX - rect.left) / rect.width) * 2 - 1;
            mouse.y = -((clientY - rect.top) / rect.height) * 2 + 1;
            
            raycaster.setFromCamera(mouse, camera);
            const intersects = raycaster.intersectObjects(bars);
            
            if (intersects.length > 0) {
                const selectedBar = intersects[0].object;
                showRiskPopup(selectedBar.userData);
                animateBarSelection(selectedBar);
            }
        }
        
        function onMouseMove(event) {
            const rect = renderer.domElement.getBoundingClientRect();
            mouse.x = ((event.clientX - rect.left) / rect.width) * 2 - 1;
            mouse.y = -((event.clientY - rect.top) / rect.height) * 2 + 1;
            
            raycaster.setFromCamera(mouse, camera);
            const intersects = raycaster.intersectObjects(bars);
            
            // Reset all bars to original state
            bars.forEach(bar => {
                bar.material.color.setHex(bar.userData.originalColor);
                bar.scale.set(1, bar.scale.y, 1);
            });
            
            // Highlight hovered bar
            if (intersects.length > 0) {
                const hoveredBar = intersects[0].object;
                hoveredBar.material.color.setHex(0xffffff);
                hoveredBar.scale.set(1.1, hoveredBar.scale.y, 1.1);
                document.body.style.cursor = 'pointer';
            } else {
                document.body.style.cursor = 'default';
            }
        }
        
        function animateBarSelection(bar) {
            // EBTA-themed pulse animation
            const originalScale = { x: bar.scale.x, z: bar.scale.z };
            const pulseScale = { x: 1.3, z: 1.3 };
            
            new TWEEN.Tween(originalScale)
                .to(pulseScale, 250)
                .easing(TWEEN.Easing.Elastic.Out)
                .onUpdate(() => {
                    bar.scale.x = originalScale.x;
                    bar.scale.z = originalScale.z;
                })
                .yoyo(true)
                .repeat(1)
                .start();
        }
        
        function showRiskPopup(userData) {
            const popup = document.getElementById('stat-popup');
            const title = document.getElementById('popup-title');
            const content = document.getElementById('popup-content');
            
            const data = riskCategoriesData[userData.index];
            
            title.textContent = `${data.category} - ${data.description}`;
            content.innerHTML = `
                <div style="margin-bottom: 20px;">
                    <p style="font-size: 1.2em; margin-bottom: 10px; color: #ffd700;">
                        <strong>Effectiveness:</strong> ${data.details.effectiveness}
                    </p>
                    <p style="margin-bottom: 15px; line-height: 1.6;">
                        <strong>Primary Controls:</strong> ${data.details.controls}
                    </p>
                </div>
                
                <div style="background: rgba(229, 62, 62, 0.1); padding: 15px; border-radius: 8px; margin: 15px 0;">
                    <h4 style="color: #e53e3e; margin-bottom: 10px;">Examples:</h4>
                    <ul style="margin: 0; padding-left: 20px; line-height: 1.5;">
                        ${data.details.examples.map(example => `<li style="margin: 5px 0;">${example}</li>`).join('')}
                    </ul>
                </div>
                
                <div style="background: rgba(255, 215, 0, 0.1); padding: 15px; border-radius: 8px; border-left: 4px solid #ffd700;">
                    <p style="font-size: 0.95em; font-style: italic;">
                        <strong>EBTA Requirements:</strong> ${data.details.requirements}
                    </p>
                </div>
            `;
            
            popup.style.display = 'block';
            
            // Auto-close after 10 seconds
            setTimeout(() => {
                if (popup.style.display === 'block') {
                    closeStatPopup();
                }
            }, 10000);
        }
        
        function closeStatPopup() {
            document.getElementById('stat-popup').style.display = 'none';
        }
        
        function animate() {
            animationId = requestAnimationFrame(animate);
            
            // Update tweens
            TWEEN.update();
            
            // Subtle camera movement for immersive feel
            const time = Date.now() * 0.0003;
            camera.position.x = Math.sin(time) * 0.3;
            camera.position.y = 6 + Math.cos(time * 0.7) * 0.2;
            camera.lookAt(0, 3, 0);
            
            // Rotate bars slightly for dynamic effect
            bars.forEach((bar, index) => {
                bar.rotation.y = Math.sin(time + index) * 0.05;
            });
            
            renderer.render(scene, camera);
        }
        
        function handleResize() {
            const width = window.innerWidth * 0.67;
            const height = window.innerHeight;
            
            camera.aspect = width / height;
            camera.updateProjectionMatrix();
            renderer.setSize(width, height);
        }
        
        // Event listeners
        window.addEventListener('resize', handleResize, false);
        
        // Close popup when clicking outside
        document.addEventListener('click', (event) => {
            const popup = document.getElementById('stat-popup');
            if (popup.style.display === 'block' && !popup.contains(event.target)) {
                closeStatPopup();
            }
        });
        
        // Initialize the application
        init();
    </script>
</body>
</html>